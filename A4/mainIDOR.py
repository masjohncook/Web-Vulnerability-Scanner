from A4.trav_attack import *

class mainIdor:

    def __init__(self, url, dir):
        self.url = url
        self.dir = dir
        self.urlParm = list()
        self.log = list()

        self.listUrl = file_to_set(self.dir + "/crawled.txt")
        #self.boot()

    def boot(self):
        #memisahkan url dengan parameter dengan yang tidak
        #print(self.listUrl)
        for url in self.listUrl:
            cek = cek_link_with_parm(url)
            if cek is True:
                self.urlParm.append(url)
        if len(self.urlParm) != 0:
            self.log.append("find " + str(len(self.urlParm)) + " url with parameter")
            for url in self.urlParm:
                print(url)
                try:
                    trav = trav_attack(url)
                    for output in trav.return_output():
                        self.log.append(output)
                except:
                    print("error")
        else:
            self.log.append("cant find URL with parameter ")

    def return_output(self):
        output = self.log
        return output

def cek_link_trav(link):
    try:
        response = requests.get(link)
        code = response.status_code
        #print(response.url)
        if link != response.url:
            return False
        else:
            return code
    except Exception as e:
        return 404

#test = cek_link_trav("http://testsite.com/get.php?f=list$g=coba")
#print(test)

#test = cek_link_trav("https://www.google.com/")
#print(test)

